# DNSmasq configuration for Replicante network filtering
# This provides DNS-level domain blocking

# Basic settings
port=53
domain-needed
bogus-priv
no-resolv
no-poll
no-hosts

# Upstream DNS servers (use reliable public DNS)
server=8.8.8.8
server=8.8.4.4
server=1.1.1.1

# Local domain
local=/replicante/
domain=replicante

# Listen on all interfaces within container
listen-address=0.0.0.0
bind-interfaces

# Logging
log-queries
log-facility=-

# Cache settings
cache-size=1000
neg-ttl=3600

# DHCP disabled
no-dhcp-interface=eth0

# Allowed domains - explicit IP mappings
# These resolve to real IPs via upstream DNS
server=/anthropic.com/8.8.8.8
server=/openai.com/8.8.8.8
server=/api.anthropic.com/8.8.8.8
server=/api.openai.com/8.8.8.8

# Internal services
address=/supervisor/172.20.0.5
address=/replicante-supervisor/172.20.0.5
address=/proxy/172.20.0.2
address=/dns/172.20.0.3
address=/localhost/127.0.0.1

# Block everything else by returning NXDOMAIN
# This is the key security feature - domains not listed above won't resolve
address=/#/0.0.0.0

# Additional security settings
stop-dns-rebind
rebind-localhost-ok
no-negcache

# Rate limiting
# Limit DNS queries per client
# Note: Adjust based on your needs
# dhcp-lease-max=150
# dhcp-authoritative

# Custom blocking message for blocked domains
# Returns a custom IP that could host a block page
# address=/blocked.invalid/172.20.0.254

# Wildcard blocking examples (uncomment to use)
# Block all subdomains of suspicious domains
# address=/.suspicious-domain.com/0.0.0.0
# address=/.malware-site.net/0.0.0.0

# Query logging for audit
# log-queries=extra